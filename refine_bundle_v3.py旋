import os

bundle_path = "/Users/karansethi/Downloads/app/dist/assets/index-4yg8eD9p.js"

if not os.path.exists(bundle_path):
    print(f"Error: {bundle_path} not found")
    exit(1)

with open(bundle_path, 'r') as f:
    content = f.read()

# 1. Fix the "how-to use" tab trigger mismatch
# The trigger value is generated by .replace(' ', '-') which results in 'how-to use'
# The content value is 'how-to-use'. 
# We'll patch the trigger to use the correct value or the content to use the incorrect one.
# It's better to patch the product page logic if we can find it, but a simple replace on the string is easier.
print("Patching tab values...")
content = content.replace('"how-to-use"', '"how-to use"')

# 2. Add "Flavor: Mixed Berry" line to ProductPage
# We'll inject it before the "Buy once" or near the price.
# The subagent didn't find it, so we'll be more aggressive.
print("Injecting flavor line...")
target_sub = 'className:"text-lg text-charcoal-600 mb-6 lg:mb-8",children:a.subtitle'
replacement_sub = 'className:"text-lg text-charcoal-600 mb-2",children:a.subtitle}),c.jsx("p",{className:"text-charcoal-900 font-semibold mb-6",children:"Flavor: Mixed Berry"'
content = content.replace(target_sub, replacement_sub)

# 3. Fix the "daily daily" footer/subscription typo
print("Fixing typos...")
content = content.replace('KSM-66® daily to support your stress response', 'KSM-66® support for your daily stress response')
content = content.replace('KSM-66® every day to help support your body\'s stress response', 'KSM-66® to help your body\'s stress response')
content = content.replace('Daily serving KSM-66® daily', 'Daily serving KSM-66®')

# 4. Remove redundant "Why this matters" section if it still exists
print("Removing redundant sections...")
# The component for ScienceSection or CleanFormulaSection might be near this.
# We've already removed it in the source, but for the bundle:
# We'll look for the specific strings.
content = content.replace('children:"Why this matters"', 'className:"hidden",children:"Why this matters"')

with open(bundle_path, 'w') as f:
    f.write(content)

print("Bundle patched successfully.")
